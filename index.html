<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>50 LPA Roadmap ‚Äî Priority Tracker</title>
  <style>
    :root {
      /* Dark Mode Palette */
      --bg-dark: #0f172a;       /* Deep Slate */
      --card-dark: #1e293b;     /* Lighter Slate */
      --primary: #818cf8;       /* Indigo */
      --accent: #2dd4bf;        /* Teal */
      --text-main: #f8fafc;     /* White-ish */
      --text-sub: #94a3b8;      /* Grey */
      
      --card-border: rgba(255, 255, 255, 0.08);
      --glow: 0 0 20px rgba(129, 140, 248, 0.15);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0;
      background-color: var(--bg-dark);
      color: var(--text-main);
      min-height: 100vh;
      /* Subtle subtle grid background */
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* HEADER */
    header {
      padding: 40px 20px;
      text-align: center;
      background: linear-gradient(180deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0) 100%);
    }

    h1 {
      margin: 0;
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(90deg, #818cf8, #c084fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
      filter: drop-shadow(0 0 15px rgba(129, 140, 248, 0.3));
    }

    p.lead { margin-top: 8px; color: var(--text-sub); font-size: 14px; }

    .container { max-width: 1000px; margin: 0 auto; padding: 0 20px 40px; }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 24px;
      align-items: start;
    }

    /* DARK CARDS */
    .card {
      background: var(--card-dark);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid var(--card-border);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    h2 { 
      margin: 0 0 20px 0; font-size: 18px; font-weight: 600; 
      color: var(--text-main); display: flex; align-items: center; gap: 10px; 
    }
    
    /* PRIORITY LIST */
    .priority { display: grid; gap: 12px; }
    .priority-item {
      display: flex; gap: 14px; align-items: center; padding: 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      border: 1px solid var(--card-border);
      transition: transform 0.2s;
    }
    .priority-item:hover { transform: translateX(4px); border-color: var(--primary); }
    
    .pri-badge {
      width: 40px; height: 40px;
      border-radius: 10px;
      background: #334155;
      color: white;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
    }

    .meta-title { font-weight: 600; font-size: 14px; color: var(--text-main); }
    .meta-sub { font-size: 12px; color: var(--text-sub); margin-top: 2px; }

    /* TASKS - Dark Aesthetic */
    .tasks { display: flex; flex-direction: column; gap: 14px; margin-top: 20px; }
    .task {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px;
      background: #273548; /* Slightly lighter than card */
      border-radius: 14px;
      border: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .task:hover {
      background: #334155;
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .tick-btn {
      background: transparent; border: none; padding: 0; cursor: pointer;
      width: 48px; height: 48px; display: flex; align-items: center; justify-content: center;
    }

    .tick-box {
      width: 44px; height: 44px;
      border-radius: 12px;
      background: #1e293b;
      border: 2px solid #475569;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }

    .tick-btn:hover .tick-box { border-color: var(--primary); }
    .tick-btn:active .tick-box { transform: scale(0.9); }
    
    .tick-box.done {
      background: var(--primary);
      border-color: var(--primary);
      box-shadow: 0 0 15px rgba(129, 140, 248, 0.4);
    }

    svg.check {
      width: 24px; height: 24px; color: #0f172a;
      opacity: 0; transform: scale(0.5);
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    svg.check.visible { opacity: 1; transform: scale(1); }

    /* STATS & HISTORY */
    .streak-stat {
      background: linear-gradient(135deg, #3b0764 0%, #7e22ce 100%);
      color: #f3e8ff;
      padding: 16px; border-radius: 14px; margin-bottom: 20px;
      font-weight: 700; display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
      border: 1px solid rgba(255,255,255,0.1);
    }

    .stat {
      display: flex; justify-content: space-between; font-size: 13px;
      padding: 10px 0; border-bottom: 1px solid var(--card-border);
      color: var(--text-sub);
    }
    .stat strong { color: var(--text-main); }
    .stat:last-child { border-bottom: none; }

    .history-item {
      font-size: 12px; padding: 10px; border-radius: 8px;
      background: rgba(0,0,0,0.2); margin-bottom: 6px;
      display: flex; justify-content: space-between;
      border-left: 2px solid var(--primary);
      color: var(--text-sub);
    }
    .history-item span:last-child { color: var(--text-main); }

    /* BUTTONS */
    .btn {
      padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer;
      font-weight: 600; font-size: 13px; transition: all 0.2s; font-family: inherit;
    }
    .btn-primary {
      background: var(--primary); color: #0f172a;
    }
    .btn-primary:hover { background: #a5b4fc; transform: translateY(-2px); }
    .btn-secondary { background: transparent; color: var(--text-sub); border: 1px solid #475569; }
    .btn-secondary:hover { border-color: var(--text-main); color: var(--text-main); }

    /* ROADMAP STYLES */
    .roadmap-container { margin-top: 10px; }
    .phase-title { 
      font-size: 16px; font-weight: 700; color: var(--accent); 
      margin-top: 30px; margin-bottom: 10px; 
    }
    .sub-title { font-size: 15px; font-weight: 600; margin-top: 20px; color: #e2e8f0; }
    .roadmap-container p { color: var(--text-sub); font-size: 14px; line-height: 1.6; }
    .highlight { background: rgba(45, 212, 191, 0.1); color: var(--accent); padding: 2px 6px; border-radius: 4px; }

    /* ANIMATIONS & MODALS */
    .toast {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px);
      background: #f8fafc; color: #0f172a; padding: 12px 24px; border-radius: 30px;
      font-weight: 600; opacity: 0; transition: all 0.3s;
      z-index: 500; box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .streak-overlay {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px); z-index: 999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .streak-overlay.show { opacity: 1; pointer-events: auto; }
    .streak-emoji { font-size: 100px; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .streak-text {
      color: white; font-size: 32px; font-weight: 800; margin-top: 20px; text-align: center;
      text-shadow: 0 0 20px rgba(129, 140, 248, 0.8);
    }
    @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }

    /* STATUS BADGE */
    .status-badge {
        display: inline-flex; align-items: center; gap: 8px;
        background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 30px;
        font-size: 12px; font-weight: 600; margin-top: 12px;
        border: 1px solid var(--card-border); color: var(--text-sub);
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #475569; }
    .status-badge.success { color: var(--accent); border-color: rgba(45, 212, 191, 0.2); }
    .status-badge.success .status-dot { background: var(--accent); box-shadow: 0 0 10px var(--accent); }
    
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 200;
    }
    .modal-backdrop.open { opacity: 1; pointer-events: auto; }
    .modal {
      background: var(--card-dark); padding: 24px; border-radius: 20px; width: 90%; max-width: 380px;
      border: 1px solid var(--card-border); text-align: center;
    }
    
    /* Entry Animation */
    .animate-entry { opacity: 0; animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    @media(max-width: 900px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1>üöÄ Priority Roadmap ‚Äî Tracker</h1>
    <p style="margin:6px 0 0;opacity:.95">Follow the high-impact 3-hour plan: backend & system design, DSA, CS fundamentals, and GitHub/resume.</p>
  </header>

  <div class="container">
    <div class="grid">
      <div class="card">
        <h2>Priority System üòÄ </h2>
        <div class="priority">
          <div class="priority-item"><div class="pri-badge">üìã</div><div class="pri-meta"><div class="meta-title">Python</div><div class="meta-sub">Deep projects: scalable services, queues, caching</div></div></div>
          <div class="priority-item"><div class="pri-badge">üìã</div><div class="pri-meta"><div class="meta-title">DSA (c++) </div><div class="meta-sub">Focused problem solving: 200‚Äì250 quality problems</div></div></div>
          <div class="priority-item"><div class="pri-badge">üìã</div><div class="pri-meta"><div class="meta-title">CS Fundamentals </div><div class="meta-sub">OS/DBMS/Networks/System design basics</div></div></div>
          <div class="priority-item"><div class="pri-badge">üìã</div><div class="pri-meta"><div class="meta-title">Web-Development </div><div class="meta-sub">Projects/Backend/React</div></div></div>
          <div class="priority-item"><div class="pri-badge">üìã</div><div class="pri-meta"><div class="meta-title">Projects & GitHub & Resume  </div><div class="meta-sub">Polish docs, README, resume </div></div></div>
        </div>

        <h3 style="margin-top:14px; font-size: 24px;" >Daily Tasks ü§ë</h3>
        
        <div class="tasks" id="tasks"></div>

        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <button class="btn btn-primary" id="export">Export Progress</button>
          <button class="btn btn-secondary" id="import">Import Progress</button>
          <input type="file" id="fileInput" accept="application/json" style="display:none" />
        </div>

      </div>

      <div class="card">
        <h2>Quick Stats</h2>
        <div class="stats" id="stats"></div>
        <h3 style="margin-top:12px">Recent History</h3>
        <div class="history" id="history"></div>
      </div>
    </div>

    <div style="margin-top:18px" class="card">
      <h2>PROJECTS AND SKILLS NEED TO BE DONE </h2>
      <style>
    .roadmap-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 25px;
        border-radius: 15px;
        background: #f7f7f7;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 1.7;
        color: #222;
        box-shadow: 0px 4px 15px rgba(0,0,0,0.1);
    }

    .roadmap-container h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
    }

    .phase-title {
        font-size: 22px;
        font-weight: bold;
        margin-top: 30px;
        color: #2e59d9;
    }

    .sub-title {
        font-size: 18px;
        font-weight: bold;
        margin-top: 15px;
        color: #444;
    }

    .roadmap-container p {
        margin: 10px 0;
    }

    .highlight {
        background: #eaf1ff;
        padding: 5px 10px;
        border-radius: 6px;
        display: inline-block;
        margin-top: 8px;
    }
</style>

<div class="roadmap-container">

    <h2>üöÄ Full 2-Year Backend + DSA Roadmap (Readable & Beautiful Format)</h2>

    <div class="phase-title">üìå Phase 1 (Month 1‚Äì3): Foundations + DSA Start</div>

    <p>
        <span class="highlight">Goal:</span> Build basic backend skills using Node, Express, and Mongo/Postgres, learn Python basics, start your DSA habit, and prepare yourself for advanced system-level projects.
    </p>

    <div class="sub-title">üîπ Step 1: Setup (Week 1)</div>
    <p>
        Install VS Code, Node.js, Python, and Git. Create your GitHub account and learn basic Git commands: commit, push, pull, and branch. Make one repo called <b>learning-log</b> and push 2‚Äì3 times every week.
    </p>

    <div class="sub-title">üîπ Step 2: Backend Basics (Weeks 1‚Äì6)</div>
    <p>
        Learn JavaScript fundamentals including variables, functions, arrays, objects, async/await, and promises.  
        Move to Node + Express: create a simple server, build GET/POST/PUT/DELETE routes, add middleware, error handling, and integrate MongoDB/Postgres with schemas and CRUD operations.  
        Build mini-projects like a <b>Notes API</b> and an <b>Auth API</b> with JWT and push everything to GitHub.
    </p>

    <div class="sub-title">üîπ Step 3: Python + DSA Basics (Weeks 1‚Äì8)</div>
    <p>
        Learn Python basics for the first 2‚Äì3 weeks: input/output, loops, if/else, lists, dictionaries, sets, tuples, functions, and comprehensions.  
        Then switch to DSA and solve ~50 easy problems (arrays, strings, hashmaps) using LeetCode/NeetCode. Target 1 problem per study day.
    </p>

    <div class="sub-title">üîπ Step 4: CS Fundamentals Starter (Weeks 4‚Äì12)</div>
    <p>
        In your daily 30-minute CS slot:  
        Mon ‚Üí OS basics  
        Tue ‚Üí DBMS basics  
        Wed ‚Üí Networks basics  
        Thu ‚Üí OOP concepts  
        Fri ‚Üí Notes, recap, and GitHub cleanup  
        Weekends ‚Üí optional revision.  
        This stage builds familiarity, not depth.
    </p>


    <div class="phase-title">üìå Phase 2 (Month 4‚Äì9): Golden Project 1 + Real DSA</div>

    <p>
        <span class="highlight">Goal:</span> Build Golden Project 1 (a real system-level backend), reach 120‚Äì150 DSA problems, and improve CS fundamentals.
    </p>

    <div class="sub-title">ü•á Golden Project 1: Food Ordering & Tracking System</div>

    <p>
        Design the system (Week 1): define entities like User, Restaurant, MenuItem, Cart, Order, DeliveryPartner, and flows such as browsing, adding to cart, placing orders, restaurant acceptance, and delivery updates. Define all REST APIs and a clean DB schema.
    </p>

    <p>
        Build core backend (Weeks 2‚Äì4): JWT auth, restaurant CRUD, menu system, cart API, and order creation. Use a clean folder structure (controllers, routes, models) and apply error handling and validation.
    </p>

    <p>
        Add role system + order tracking (Weeks 5‚Äì7):  
        Roles ‚Üí User, RestaurantOwner, DeliveryPartner  
        APIs ‚Üí accept/reject order, update delivery status, view live status  
        Testing can be done via Postman or a simple React UI.
    </p>

    <p>
        Add performance layer (Weeks 8‚Äì10): integrate Redis caching for restaurant list and menus, add pagination, log response times, and document ‚Äúbefore vs after caching‚Äù improvements for your resume.
    </p>

    <p>
        Deployment (Weeks 11‚Äì12): deploy on Render/Railway. Optional simple React UI for restaurants, menu, cart, and order status. Add a professional README with architecture, endpoints, setup, and optimizations.
    </p>

    <div class="sub-title">üß† DSA Target: 50 ‚Üí 150 problems</div>
    <p>
        Add 50‚Äì60 problems on two pointers, sliding window, linked lists, stacks, queues, then another 40‚Äì50 on binary search, recursion, backtracking, and trees.  
        Focus on solving <b>1 problem/day</b> and write clean Python code.
    </p>

    <div class="sub-title">üéì CS Fundamentals Upgrade</div>
    <p>
        Learn deeper OS topics like scheduling and deadlocks, DBMS concepts like indexing and transactions, and Networks topics like TCP 3-way handshake and HTTPS. Maintain short, reusable notes.
    </p>


    <div class="phase-title">üìå Phase 3 (Month 10‚Äì15): Golden Project 2 + Strong DSA</div>

    <p>
        <span class="highlight">Goal:</span> Build Golden Project 2 (a distributed system), finish 200‚Äì220 DSA problems, and learn practical system design.
    </p>

    <div class="sub-title">ü•á Golden Project 2: Task Queue & Scheduler Service</div>

    <p>
        Design the system (Week 1): the system will take job requests (email, reports), store them in DB, process jobs via a worker, retry failures, and send failed ones to a dead-letter queue. Add a metrics or dashboard endpoint.
    </p>

    <p>
        Build core APIs (Weeks 2‚Äì4): create POST /jobs and GET /jobs/:id, define job schema (id, type, payload, status, retries, timestamps).
    </p>

    <p>
        Build worker + retry logic (Weeks 5‚Äì7): worker will poll pending jobs, execute them, update status, and implement exponential backoff retry logic.
    </p>

    <p>
        Add dead-letter queue + metrics (Weeks 8‚Äì10): move failed jobs after max retries, add metrics like total processed, failed, and average latency.
    </p>

    <p>
        Dashboard + Docs (Weeks 11‚Äì12): optional React dashboard, plus a detailed README covering design choices, failure handling, scaling ideas, and architecture.
    </p>

    <div class="sub-title">üß† DSA Target: 200‚Äì220 problems</div>
    <p>
        Complete topics like medium trees, graphs, BFS/DFS, basic DP, heaps, and priority queues.
    </p>

    <div class="sub-title">üìö System Design Basics</div>
    <p>
        Study caching, load balancing, replication, sharding, and apply these concepts to your own projects by writing how you would scale each system.
    </p>


    <div class="phase-title">üìå Phase 4 (Month 16‚Äì24): Polish, Resume, Open Source, Jobs</div>

    <p>
        <span class="highlight">Goal:</span> Become job-ready, finalize your profile, revise deeply, and apply smartly.
    </p>

    <p>
        Build a polished one-page resume with your two golden projects, metrics, skills, tools, and DSA count.  
        Clean your GitHub by pinning top repos with strong READMEs.  
        Optionally do 2‚Äì3 open-source contributions or create a small npm/Python utility.  
        Prepare for interviews by revising both projects deeply, re-solving DSA patterns, and reviewing CS notes.
    </p>

    <p>
        Start applying to product companies like CRED, PhonePe, Razorpay, and backend-focused startups. Eventually apply to international remote roles once confident.
    </p>

    <div class="sub-title">‚úî Final Checklist</div>
    <p>
        Learn backend ‚Üí learn Python ‚Üí solve 200+ DSA ‚Üí build Golden Project 1 ‚Üí build Golden Project 2 ‚Üí learn CS fundamentals ‚Üí polish resume & GitHub ‚Üí apply smartly.
    </p>

</div>

  </div>

  <div class="toast" id="toast">Marked as done for today ‚úÖ</div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" style="display:none">
    <div class="modal" id="modal">
      <h3 id="modalTitle">Confirm</h3>
      <p id="modalMessage">Are you sure?</p>
      <div class="modal-actions">
        <button class="btn" id="modalCancel">No</button>
        <button class="btn btn-primary" id="modalConfirm">Yes</button>
      </div>
    </div>
  </div>

<script>
/* CONFIGURATION & DATA 
*/
const TASKS = [
  { id: 'backend', title: 'üìí Backend + System Design', desc: 'Deep projects: scalable services, queues, caching' },
  { id: 'dsa_problems', title: 'üñä DSA (C++)  (Problems)', desc: 'Focused problem solving: 200‚Äì250 quality problems' },
  { id: 'dsa_learning', title: 'üìñ DSA  (Learning)', desc: 'Theory learning and understanding the concepts' },
  { id: 'cs', title: 'üìí CS Fundamentals', desc: 'OS/DBMS/Networks/System design basics' },
  { id: 'python_learning', title: 'üìñ Python (Learning)', desc: 'Core syntax, stdlib, OOP, idiomatic Python' },
  { id: 'python_projects', title: 'üñä Python  (Projects)', desc: 'Build mini-projects: scripts, automation, small apps' },
  { id: 'webdev_project', title: 'üñä Web Dev  (Project)', desc: 'Build a full-stack project: deploy, README, tests' },
  { id: 'github', title: 'üìí GitHub & Resume', desc: 'Polish docs, README, resume' },
  { id: 'wedev', title: 'üìñ Web Dev (Learning)', desc: 'Learning about the concepts' }
];

const STORAGE_KEY = 'priority_roadmap_v1';
const CLOUD_TOKEN_KEY = 'priority_roadmap_gist_token';
const CLOUD_GISTID_KEY = 'priority_roadmap_gist_id';
const CLOUD_FILENAME = 'priority_roadmap.json';
const CLOUD_DESCRIPTION = 'Priority Roadmap ‚Äî auto-sync backup (private)';

/* DATE UTILS 
*/
function todayISO(){ 
  const d = new Date();
  const offsetDate = new Date(d.getTime() - (d.getTimezoneOffset() * 60000));
  return offsetDate.toISOString().slice(0, 10);
}
function weekKey(dateISO){ const d=new Date(dateISO+'T00:00:00'); const day=(d.getDay()+6)%7; const monday=new Date(d); monday.setDate(d.getDate()-day); monday.setHours(0,0,0,0); return monday.toISOString().slice(0,10); }

/* DATA MANAGEMENT 
*/
function ensureStoreShape(store){
  const out = Object.assign({}, store);
  TASKS.forEach(t => { if (!Array.isArray(out[t.id])) out[t.id] = []; });
  return out;
}
// Only used for internal logic, not for cloud loading anymore
function mergeStores(base,incoming){
  const out = Object.assign({}, base);
  incoming = ensureStoreShape(incoming);
  TASKS.forEach(t=>{
    const a = Array.isArray(out[t.id]) ? out[t.id].slice() : [];
    const b = Array.isArray(incoming[t.id]) ? incoming[t.id].slice() : [];
    const set = new Set([...(a||[]), ...(b||[])]);
    out[t.id] = Array.from(set).sort((x,y)=>x.localeCompare(y));
  });
  return out;
}
function saveData(d){ try { localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); } catch(e){ console.error('saveData error', e); } }
function loadData(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw){ const obj={}; TASKS.forEach(t=>obj[t.id]=[]); return obj; }
  try{ return ensureStoreShape(JSON.parse(raw)); } catch(e){ const obj={}; TASKS.forEach(t=>obj[t.id]=[]); return obj; }
}

let STORE = loadData();

/* CLOUD SYNC (API) 
*/
function getCloudToken(){ return localStorage.getItem(CLOUD_TOKEN_KEY) || null; }
function setCloudToken(token){ if(token) localStorage.setItem(CLOUD_TOKEN_KEY, token); else localStorage.removeItem(CLOUD_TOKEN_KEY); }
function getCloudGistId(){ return localStorage.getItem(CLOUD_GISTID_KEY) || null; }
function setCloudGistId(id){ if(id) localStorage.setItem(CLOUD_GISTID_KEY, id); else localStorage.removeItem(CLOUD_GISTID_KEY); }
function cloudEnabled(){ return !!getCloudToken(); }

async function findExistingGist(token) {
  const url = 'https://api.github.com/gists?cb=' + new Date().getTime();
  const res = await fetch(url, { headers: { 'Authorization': 'token ' + token } });
  if(!res.ok) throw new Error('Find failed: ' + res.status);
  const gists = await res.json();
  const found = gists.find(g => g.files && g.files[CLOUD_FILENAME]);
  return found ? found.id : null;
}

async function createGist(token, contentStr){
  const url = 'https://api.github.com/gists';
  const body = { description: CLOUD_DESCRIPTION, public: false, files: { [CLOUD_FILENAME]: { content: contentStr } } };
  const res = await fetch(url, { method: 'POST', headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  if(!res.ok) throw new Error('Create failed: ' + res.status);
  return await res.json();
}

async function updateGist(token, gistId, contentStr){
  const url = `https://api.github.com/gists/${gistId}`;
  const body = { files: { [CLOUD_FILENAME]: { content: contentStr } } };
  const res = await fetch(url, { method: 'PATCH', headers: { 'Authorization': 'token ' + token, 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
  if(!res.ok) throw new Error('Update failed: ' + res.status);
  return await res.json();
}

async function fetchGistContent(token, gistId){
  const url = `https://api.github.com/gists/${gistId}?timestamp=${new Date().getTime()}`;
  const res = await fetch(url, { headers: { 'Authorization': 'token ' + token } });
  if(!res.ok) throw new Error('Fetch failed: ' + res.status);
  const data = await res.json();
  if(!data.files || !data.files[CLOUD_FILENAME]) throw new Error('Gist missing file');
  return data.files[CLOUD_FILENAME].content;
}

function debounce(fn, wait){ let t = null; return (...args)=>{ if(t) clearTimeout(t); t = setTimeout(()=>fn(...args), wait); }; }

/* SYNC LOGIC 
*/
let scheduledCloudSave = debounce(async () => {
  if(!cloudEnabled()) { setSyncStatus('Offline', 'offline'); return; }
  
  setSyncStatus('Saving...', 'working');
  
  const token = getCloudToken();
  let gistId = getCloudGistId();
  const contentStr = JSON.stringify(STORE, null, 2);
  
  try{
    if(!gistId){
      gistId = await findExistingGist(token);
      if(gistId) setCloudGistId(gistId);
      else { const created = await createGist(token, contentStr); setCloudGistId(created.id); gistId = created.id; }
    }
    await updateGist(token, gistId, contentStr);
    setSyncStatus('Cloud Synced', 'success');
  } catch(err){ 
    console.error('Cloud save failed', err); 
    setSyncStatus('Sync Error', 'error'); 
  }
}, 2000);

async function loadFromCloudAndMerge(){
  if(!cloudEnabled()) { setSyncStatus('Offline', 'offline'); return; }
  
  setSyncStatus('Loading...', 'working');
  
  const token = getCloudToken();
  let gistId = getCloudGistId();
  
  try{
      if(!gistId) { 
          gistId = await findExistingGist(token); 
          if(gistId) setCloudGistId(gistId); 
      }
      if(!gistId) { setSyncStatus('No Data Found', 'error'); return; }

      const content = await fetchGistContent(token, gistId);
      const parsed = JSON.parse(content);
      
      // --- üî• THE FIX IS HERE üî• ---
      // Instead of merging, we overwrite local with cloud.
      // This ensures deletions (unticks) are respected.
      STORE = ensureStoreShape(parsed);
      
      saveData(STORE);
      renderAll();
      setSyncStatus('Cloud Synced', 'success');
  } catch(err){ 
      console.error('Cloud load failed', err); 
      setSyncStatus('Connection Failed', 'error'); 
  }
}

/* UI COMPONENTS 
*/
function createSyncControls(){
  const header = document.querySelector('header');
  const badge = document.createElement('div');
  badge.className = 'status-badge';
  badge.id = 'statusBadge';
  const dot = document.createElement('div');
  dot.className = 'status-dot';
  const text = document.createElement('span');
  text.id = 'statusText';
  text.textContent = 'Offline';
  badge.appendChild(dot);
  badge.appendChild(text);
  header.appendChild(badge);
  if(cloudEnabled()) setSyncStatus('Ready', 'offline');
}

function setSyncStatus(msg, type){
  const badge = document.getElementById('statusBadge');
  const text = document.getElementById('statusText');
  if(badge && text){
      text.textContent = msg;
      badge.className = 'status-badge';
      if(type) badge.classList.add(type);
  }
}

function ticksThisWeek(id){ const arr = STORE[id]||[]; const wk=weekKey(todayISO()); return arr.filter(d=>weekKey(d)===wk).length; }
function canTickToday(id){ const arr = STORE[id]||[]; const last = arr.length?arr[arr.length-1]:null; if(last===todayISO()) return false; if(id==='github') return ticksThisWeek(id) < 3; return true; }

const modalBackdrop = document.getElementById('modalBackdrop');
const modalTitle = document.getElementById('modalTitle');
const modalMessage = document.getElementById('modalMessage');
const modalConfirm = document.getElementById('modalConfirm');
const modalCancel = document.getElementById('modalCancel');
let pendingAction = null;
function openModal(title,message,action){ pendingAction = action; modalTitle.textContent = title; modalMessage.textContent = message; modalBackdrop.style.display='flex'; setTimeout(()=>modalBackdrop.classList.add('open'),10); modalConfirm.focus(); }
function closeModal(){ modalBackdrop.classList.remove('open'); setTimeout(()=>{ modalBackdrop.style.display='none'; pendingAction=null; },180); }
modalCancel?.addEventListener('click', closeModal);
modalBackdrop?.addEventListener('click', (e)=>{ if(e.target===modalBackdrop) closeModal(); });
modalConfirm?.addEventListener('click', ()=>{ if(!pendingAction) return closeModal(); const {type,id} = pendingAction; if(type==='tick') performTick(id); else if(type==='undo') performUndo(id); closeModal(); });

function showToast(msg){ const t=document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1800); }

function performTick(id){
  STORE[id] = STORE[id] || []; STORE[id].push(todayISO()); 
  // removed merge here, just simple assignment
  saveData(STORE); renderAll(); showToast('Marked as done for today ‚úÖ'); if(cloudEnabled()) scheduledCloudSave();
}
function performUndo(id){
  const arr = STORE[id] || []; if(!arr.length || arr[arr.length-1] !== todayISO()) return;
  arr.pop(); STORE[id] = arr; saveData(STORE); renderAll(); showToast('Undo successful'); if(cloudEnabled()) scheduledCloudSave();
}
function onTickClick(id){
  const arr = STORE[id] || []; const last = arr.length?arr[arr.length-1]:null;
  if(last === todayISO()){ openModal('Undo tick?','Undo today\'s tick?',{type:'undo',id}); return; }
  if(id==='github' && ticksThisWeek(id) >= 3){ openModal('Limit reached','GitHub task already has 3 ticks this week.', {type:'noop'}); return; }
  openModal('Confirm tick','Mark as done?',{type:'tick',id});
}
function svgCheck(visible){ return `<svg class='check ${visible ? "visible":""}' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path fill='none' stroke='currentColor' stroke-width='3' stroke-linecap='round' stroke-linejoin='round' d='M20 6L9 17l-5-5' /></svg>`; }

function renderAll(){
  STORE = ensureStoreShape(STORE);
  const tasksEl = document.getElementById('tasks');
  tasksEl.innerHTML = '';
  TASKS.forEach(t=>{
    const arr = STORE[t.id] || [];
    const last = arr.length?arr[arr.length-1]:null;
    const isDoneToday = last === todayISO();
    const btnEnabled = canTickToday(t.id) || isDoneToday;
    const div = document.createElement('div'); div.className='task';
    div.innerHTML = `
      <div style='display:flex;gap:12px;align-items:center'>
        <div style='width:4px;height:48px;background:${isDoneToday?'var(--primary)':'#cbd5e1'};border-radius:4px'></div>
        <div><div style='font-weight:700'>${t.title}</div><div class='meta-sub'>${t.desc}</div></div>
      </div>
      <div style='display:flex;align-items:center;gap:12px'>
        <div style='text-align:right;font-size:12px;color:#94a3b8'><div>Total: <strong style="color:#475569">${arr.length}</strong></div></div>
        <button class='tick-btn' data-id='${t.id}' ${btnEnabled ? '' : 'disabled'}>
          <div class='tick-box ${isDoneToday ? 'done' : ''}'>${svgCheck(isDoneToday)}</div>
        </button>
      </div>`;
    tasksEl.appendChild(div);
  });
  document.getElementById('stats').innerHTML = TASKS.map(t=> `<div class='stat'><div>${t.title.split('‚Äî')[0]}</div><div><strong>${(STORE[t.id]||[]).length}</strong></div></div>`).join('');
  const flat = Object.entries(STORE).flatMap(([id,arr]) => (arr||[]).map(d=>({id,date:d}))).sort((a,b)=>b.date.localeCompare(a.date));
  document.getElementById('history').innerHTML = flat.slice(0,50).map(it=> `<div class='history-item'><span>${it.date}</span><span>${TASKS.find(t=>t.id===it.id)?.title||it.id}</span></div>`).join('');
  document.querySelectorAll('.tick-btn').forEach(btn=>{ btn.onclick = ()=>onTickClick(btn.dataset.id) });
}

// Export/Import
document.getElementById('export').onclick = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(STORE, null, 2)], {type: 'application/json'})); a.download = 'priority_roadmap.json'; a.click(); };
document.getElementById('import').onclick = () => document.getElementById('fileInput').click();
document.getElementById('fileInput').onchange = (e) => { const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload = (ev) => { try{ STORE = mergeStores(STORE, JSON.parse(ev.target.result)); saveData(STORE); renderAll(); if(cloudEnabled()) scheduledCloudSave(); }catch(e){alert('Invalid JSON');} }; r.readAsText(f); };

// --- LOGIN LOGIC ---
const params = new URLSearchParams(window.location.search);
if(params.has('token')){
    const t = params.get('token');
    if(t && t.startsWith('ghp_')){
        setCloudToken(t);
        window.history.replaceState({}, document.title, window.location.pathname);
        showToast('Auto-login successful! üîì');
        loadFromCloudAndMerge();
    }
}

// Init
createSyncControls();
renderAll();
if(cloudEnabled()) loadFromCloudAndMerge();
</script>
</body>
